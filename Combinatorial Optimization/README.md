   # Finding the Fantasy Team
**Group 7: Liam A., Jashan B., James W., Yao W.**  
**March 2025**
Link to Latex File: https://www.overleaf.com/read/cpxqrpkdpnhs#94a8d2
---

## Introduction

The National Basketball Association, known as the NBA, is the most watched basketball league in the world, with millions of fans tuning in to support their favourite teams every season. One of the most common conversations among fans is who they would like to add to their team if they were the general manager. Lots of fans will often feel they can run their team much better and win a championship. We set out to try and answer that question of which players to choose as a GM to make the best team in the NBA. We did this with the help of combinatorial optimization by framing roster choice as a 0-1 packing problem. 
As expected, there were multiple challenges because defining what numerically makes a team great is one of the biggest unsolved questions in sports analysis. We ended up having three distinct metrics for the value of a player and thus three different objective functions. 
The weakest team was generated from maximizing the roster’s Net Rating (Offensive Rating – Defensive Rating). The second best and possibly most realistic team from the perspective of a General Manager in the NBA was generated by maximizing the player efficiency rating (PER). Lastly, the best team was generated from minimizing each player's distance from the league leaders with respect to their individual stats. This team was deemed too overpowered, and the trades to acquire it would likely be infeasible due to the high value of each player. If the trades were somehow possible, they would likely be vetoed by the commissioner of the NBA as done in the past to block certain players from teaming up.

---

## Mathematical Tools and Theory

### A Twist of the Knapsack Problem

The problem at hand is a twist on the classic knapsack problem.

$$ \text{max } \sum_i v_i x_i $$
$$ \text{subject to} $$
$$ \sum_i w_i x_i \le C $$

Where $v_i$ is the value of item $i$, $x_i$ indicates whether item $i$ is chosen or not, $w_i$ is the weight of item $i$ and $C$ is the maximum weight that the knapsack can hold.

Instead of packing the most valuable items in the knapsack, the optimal NBA team would amalgamate players to build the best performing team. Team performance has to be quantified by some metric. In this project, team performance was chosen to be quantified three different ways:

1. The net rating: player offensive rating − player defensive rating  
2. The total efficiency rating  
3. The "distance" from leading statistics  

The salary of each player would be the individual weights in the knapsack problem and the budget a team manager has for purchasing the team would be the maximum capacity the knapsack can hold. The problem aims at choosing the best performing players within the league maximum NBA operating budget.

---

### Additional Constraints

Aside from the salary cap that a team has, there are additional constraints to comply with game technicalities as well as ensuring that players are not only affordable but have high performing statistics.

One constraint would be roster size. There can only be so many players and spares on a team. There has to be at least one of each position as well so that the algorithm doesn't only select players that main one position.

Another constraint would be average performance statistics. To select an optimal team, there has to be a benchmark to quantify how good the selected players are. Otherwise, the algorithm might choose players purely based on salary and not consider performance.

---

## Definitions and Notation

In general, the problems will be modelled as a twist of the classical knapsack problem:


$$ \text{max } \sum_i v_i x_i $$

$$
\text{subject to}
$$

$$
\sum_i w_i x_i \le C
$$

$$
\mathbf{A}x \ge b
$$

For the programs formulated, these are some key variables that will be used:

- $v_i$ represents the quantified value that player $i$ brings.  
- $x_i$ is the decision variable (0 or 1).  
- $\mathbf{A}$ is a matrix of statistical measures.  
- $b_i$ is the minimum statistical requirement for each stat.  
- $w_i$ represents each player's salary.  
- $\alpha$ represents a varying scalar applied to offensive rating.  
- $\beta$ represents a varying scalar applied to defensive rating.  

$\alpha$ and $\beta$ are parameters in the objective function to adjust weights of offensive and defensive rating.

---

## Modelling Process

### Preprocessing the Data

All data collection was done through  
`[cite: data]` for the player stats. The stats collected were:   Points `PTS`, Rebounds `REB`, Assists `AST`, Steals `STL`, Blocks `BLK`, Offensive Rating `ORTG`, Defensive Rating `DRTG`, Win Shares `WS`.

Then, we needed to collect the stats which would help narrow our selection set, particularly because some players who have only played a handful of games or even a few minutes would have very high offensive rating. One such player was Braxton Key who had an ORTG of 227. To put into perspective how high this is, the MVP of that season, Joel Embiid had an ORTG of 124. This was because Braxton Key had only played 9 minutes in the entire season across 3 games and did not miss a shot during those 9 minutes. He also only attempted 5 shots that season. Therefore, we restricted our dataset to players who had played at least 58 games that season, which is also the league minimum to be considered for league leader in a stat. Similarly, we restricted the minutes played per game to above 5 minutes which is approximately 10\% of a 48 minute game. This took our data set of 537 players down to 245 players.

Finally, the other set of data we needed to collect was a stat breakdown of a “good” team. We did so by looking at the championship rosters over a 20 year span from 2003-2023. The stats for each winning roster was simply a sum of each stat from each player on the roster. For example, to get the points per game of a winning team we would simply sum the points per game of each player on the roster. We then averaged out those sums over the 20 winning teams to get an “ideal stat threshold” of roughly 

- 110.8 Points
- 25.3 Assists
- 45.6 Rebounds
- 8.5 Steals
- 5.8 Blocks

all of which were the per game stats. This collection of “ideal stats” to use as a threshold constraint was necessary because, as mentioned above, certain players could still have high Offensive Rating or Player Efficiency while not having high stats. This threshold ensures that our overall team maintains a high collection of stats. More importantly, this constraint will ensure that we have a balanced roster which does not over prioritize a given stat. For example, without this threshold we could get a team of very offensive players that gives us an incredibly high points per game value but they could all have very low assists. This would mean the team wouldn’t be likely to actually get that many points because the players selected would not be ones that typically share the ball.

---

### Setting Up the Model

All three of our models had the exact same constraints according to the following equations. In the objective function $v^T$ represents our value coefficient which differs for each of the 3 approaches.

$$
\text{Maximize } (v^T x)
$$

$$
a_{11}x_1 + \dots + a_{1n}x_n \ge 110.8 \text{ Points}
$$

$$
a_{21}x_1 + \dots + a_{2n}x_n \ge 25.3 \text{ Assists}
$$

$$
a_{31}x_1 + \dots + a_{3n}x_n \ge 45.6 \text{ Rebounds}
$$

$$
a_{41}x_1 + \dots + a_{4n}x_n \ge 8.5 \text{ Steals}
$$

$$
a_{51}x_1 + \dots + a_{5n}x_n \ge 5.8 \text{ Blocks}
$$

$$
a_{61}x_1 + \dots + a_{6n}x_n \le 136{,}021{,}000 \text{ Salary Cap}
$$

$$
x_i \in \{0,1\}
$$

We also added constraints to ensure the roster had at least 14 players and at most 15 players according to the NBA restrictions on roster size. In addition to this, we limited the choices to have at least two players from each position: 

### Player positions

![Player positions](photos/player_pos.png)

---

## Approach 1: Maximize Net Rating (ORTG − DRTG)

In the first approach, we chose an objective function which maximized the ‘Net Rating’ of each player. The Net Rating is calculated by subtracting the defensive rating from the offensive rating. Offensive Rating and Defensive Ratings are a complex statistic first defined by statistician Dean Oliver. The breakdown of the calculation can be seen at \cite{odratings}.  Plainly put, Offensive Rating is a measure of how many points is a player likely to generate over 100 possessions. Defensive Rating is a measure of how many points the player allows the opposition to score per 100 possessions. This is why Net Rating is calculated as $Offensive - Defensive$. The greater the difference between points scored and points allowed, the better that player is. The objective function was therefore:

$$
\text{Max } (\textbf{Net Rating})^T \mathbf{x} \text{ with the constraint } A\mathbf{x}\geq b
$$

using the constraints mentioned in equation (1).
This approach gave us the following roster.

![Net Rating Results](photos/net_rating.png)

---

## Approach 2: Maximize Player Efficiency Rating (PER)

PER is computed as:

In our second approach, we chose an objective function which maximized the ‘Player Efficiency Rating’ of each player. The PER is calculated as a 

$$ \sum {(\text{Positive contributions}) - (\text{Negative Contributions})} $$ 
$$ 1 + 1 = 2 $$

and returns a per minute rating of the players performance. An example of a positive contribution is points, assists, rebounds. Negative contributions are shown in stats like missed shots, turnovers, fouls, etc. The Player Efficiency Rating statistic was created by ESPN columnist John Hollinger. A larger breakdown of how this is calculated can be seen at \cite{per}. The objective function is as follows:
$$\text{Max } (\textbf{PER})^T \mathbf{x} \text{ with the constraint } A\mathbf{x}\geq b$$ using the constraints mentioned in equation (1).
This approach gave us the following roster.

![PER Results](photos/per.png)

---

## Approach 3: Minimize Distance to Best in the League

The third approach was one uniquely created by us. The best players in the league for a given statistic are awarded at the end of the season. In the 2022-2023 season, Joel Embiid was the points leader with 33.1 points per game. Damonta Sabonis led the league with 12.3 rebounds per game. James Harden was the assists leader with 10.7 assists per game. Lastly, Nikola Jokic, an MVP calibre player, was the league leader in win shares with 14.9 win shares per game. Win shares is defined as a measure of a player's individual contribution to his team's wins \cite{winshares}. The objective function minimizes the absolute difference between the chosen players stats compared to the league leaders. The weight of the individual stat is equal since we are looking for the most balanced players and avoid the extreme cases where players only scores and does not defend for example. The objective function is defined as follows:

$$\text{Min } (|33.1 - PTS| + |12.3 - REB| + |10.7 - AST| + |14.9 - WS|)^T \mathbf{x} $$

$$\text{ with the constraint } Ax \geq b$$ 

using the constraints mentioned in equation (1).

This approach is simply the L1 norm of players ‘distance’ to the best stats in the league. The L1 norm is convex and therefore a valid function to use in optimization. This approach gave us the objectively best team in terms of individual's stats. The lineup is displayed in Figure 4 and the selected players' L1 norm are compared to the L1 norm of the non-selected players in the scatter plot.

![Selected Players](photos/table%20of%20selected.png)
![Scatter Plot](photos/scatter%20plot%20of%20selected.png)

---

## Comparison of Selected vs Non-selected Players

Among the $3$ output rosters of the approaches, we attempted to choose the best roster to analyze the results. While approach $3$ gave us the objectively best player stats, we ruled out the team because the players are mostly high-valued and have high transfer fees. While the total salary is still under the salary cap, it would be unrealistic to recruit all the players from their current team. The other two approaches return more realistic results, and we chose the result with higher average stats. With player efficiency rating (PER) as the objective, we obtained the optimal team of $15$ players. The selected players are compared to the other players to understand what stats have the most effects on the results. 

In the scatter plots, we plot each stat against salary and see how the selected players compare to the other players.  In the scatter plots of rebounds, points, offensive rating, and defensive rating, we see that most of the selected players lie on the higher spectrum in terms of the stats when compared to the rest of the league. This means that rebounds, points, offensive rating, and defensive rating are prioritized in the calculation of PER. This characteristic is not evident in the plots of blocks, assists, and steals, and the chosen players are on the lower spectrum.  In the NBA, players generally have low blocks, assists, and steals, and due to the scale of the stats, the selected players appear on the lower spectrum relative to the other players. If we look at the difference between the selected players and the rest, it is not as significant as that in rebounds, points, offensive rating, and defensive rating. The scatter plots also show a mix of players with low and high salary, and this is expected due to the salary cap in the constraints. The algorithm essentially chose the player combination with the highest stats while keeping the salary low.

![Points vs Salary](photos/1.png)
![Defensive Rating vs Salary](photos/2.png)

![Assists vs Salary](photos/3.png)
![Offensive Rating vs Salary](photos/4.png)

![Steals vs Salary](photos/5.png)

In the bar plots, we compare the average stats of the selected team with the non-selected players. In every stat other than defensive rating, the average of the selected players is higher. Since a defensive rating indicates the player is good defensively, the results are aligned with our goal of optimizing the stats of the players.

![Ratings](photos/8.png)
![More stats](photos/7.png)

---

## Conclusion and Future Considerations

In conclusion, due to the unrealistically high star calibre of the league leaders team we will disregard that solution. Although it is important to note that it is objectively the best team using the calculable metrics of Points, Assists, Rebounds, and Win Shares which the league tracks over the season. The players chosen for that roster are the closest to a combination of the highest stats in the league. This leaves us with the choice of the Net Rating team and the PER team. At this point the choice is purely due to preference and coaching style because the rosters are both objectively good with a combination of star players and role players. The Net Rating team is perhaps more realistic from a visual inspection of the stats of each player along with having only $2$ All-Star calibre players in Shai-Gilgeous Alexander and Jimmy Butler. In comparison the PER team has $4$ All-Stars: Damian Lillard, Nikola Jokic, Ja Morant, and Joel Embiid. In the 20 year span of historic data that we collected from 2003-2023 only $5$ teams had $4$ All-Stars while no team in NBA history has had $5$ or more. Therefore, the PER team is not entirely unrealistic but it is much more likely to build a competitive and realistic roster through trades and free agency in the current NBA using the Net Rating Team.

---

## Future Considerations

This project has only reaffirmed that it is a challenge to properly formulate a quantifiable metric asserting the value of a player with which teams can build a realistically attainable championship roster. In particular, the game of basketball suffers from a lack of defensive stat collection. This is because the two main quantifiable defensive stats - Block and Steals - are too rare to reliably use as a defensive metric. Typically defensive prowess is attributed to a team rather than a player. This is also because of the many different methods of defending like Man to Man and Zone defense in which a player is responsible for an area of the court. A possible option to consider is physical traits such as height and strength of the player as a defensive metric. Taller players are typically able to stop shots more reliably due to their size, while stronger players are able to hold off offensive players easier. The reason offensive stats work much better is because in basketball regardless of the team’s rotations and style of play, only an individual player can score the basketball at the end of the play. There are many factors to consider and so for future iterations of this project there are the following recommendations:

- Use more stats such as shot percentage, shots attempted, or even account for the preference of 3 point shots as being more valuable if the player can score them reliably.
- Perform data analysis using machine learning to identify patterns and come up with a unique metric for valuing a player. This would allow for a much more unique objective function and perhaps give more realistic teams
- Consider an objective function in which the choice of a player depends on other players. A possible method is to separate players by identifiable playing styles and define functions which display a team chemistry value depending on which playing styles are on the same roster.

There are a multitude of different methods to formulate this problem which is why it is such an interesting topic that fans love to discuss.

---

## References

@online{data,
  author = {Basketball Reference},
  title = {Basketball Reference: NBA Stats and History},
  year = {2025},
  url = {https://www.basketball-reference.com},
  urldate = {2025-04-02}
}

@online{odratings,
  author = {Basketball Reference},
  title = {Calculating Individual Offensive and Defensive Ratings},
  year = {2025},
  url = {https://www.basketball-reference.com/about/ratings.html},
  urldate = {2025-04-02}
}

@online{per,
  author = {Basketball Reference},
  title = {Calculating PER},
  year = {2025},
  url = {https://www.basketball-reference.com//about/per.html},
  urldate = {2025-04-02}
}

@online{winshares,
  author = {Basketball Reference},
  title = {NBA Win Shares},
  year = {2025},
  url = {https://www.basketball-reference.com/about/ws.html},
  urldate = {2025-04-02}
}
